const _0x1a=(...a)=>a,_0x2b=require;const express=_0x2b('express'),path=_0x2b('path'),fs=_0x2b('fs'),https=_0x2b('https'),http=_0x2b('http'),querystring=_0x2b('querystring'),app=express(),port=process.env.PORT||3000;const DISCORD_CLIENT_ID="1470437832253247520",DISCORD_CLIENT_SECRET="wD4TCV71Y77Ea0HBORLeIXv_6PwZjf7R",DISCORD_REDIRECT_URI="https://aethel-development.onrender.com/api/auth/discord/callback";app.use(express.json({limit:'50mb'}));app.use(express.static(__dirname));const DB_FILE='database.json',MASTER_KEY="luath-master-key-2026";let db={apiKeys:[],projects:{},settings:{},registrations:[],bannedIPs:[]};function loadDB(){if(fs.existsSync(DB_FILE)){try{const r=fs.readFileSync(DB_FILE);db=JSON.parse(r);db.apiKeys=db.apiKeys||[];db.projects=db.projects||{};db.settings=db.settings||{};db.registrations=db.registrations||[];db.bannedIPs=db.bannedIPs||[]}catch(e){saveDB()}}else saveDB()}function saveDB(){try{fs.writeFileSync(DB_FILE,JSON.stringify(db,null,2))}catch(e){console.error("Error saving DB:",e)}}loadDB();function generateId(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}function getClientIp(r){const f=r.headers['x-forwarded-for'];if(f)return f.split(',')[0].trim();return r.connection.remoteAddress||r.socket.remoteAddress}app.use((q,s,n)=>{const i=getClientIp(q);if(db.bannedIPs&&db.bannedIPs.includes(i))return s.status(403).send("Banned.");n()});app.use((q,s,n)=>{s.header("Access-Control-Allow-Origin","*");s.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept");s.header("Access-Control-Allow-Methods","GET, POST, OPTIONS");if(q.method==='OPTIONS')return s.sendStatus(200);n()});function obfuscateLua(c){const sc=['I','l','_'],ac=['I','l','1','_'],gv=l=>{let r=sc[Math.floor(Math.random()*sc.length)];for(let i=1;i<l;i++)r+=ac[Math.floor(Math.random()*ac.length)];return r};const v_str=gv(6),v_char=gv(7),v_table=gv(5),v_concat=gv(8),v_load=gv(4),v_data=gv(5),v_res=gv(5),v_idx=gv(4),v_val=gv(4);const k=Math.floor(Math.random()*200)+10,s=Math.floor(Math.random()*50)+1;let b=[];for(let i=0;i<c.length;i++){let x=c.charCodeAt(i);let e=((x+s+(i%17))%256)^k;b.push(e)}const t=b.join(',');const ldr=`local ${v_str}=string;local ${v_char}=${v_str}.char;local ${v_table}=table;local ${v_concat}=${v_table}.concat;local ${v_load}=loadstring or load;local function ${gv(10)}()local ${v_data}={${t}};local ${v_res}={};local _k=${k};local _s=${s};for ${v_idx}=1,#${v_data} do local ${v_val}=${v_data}[${v_idx}];local _x=bit and bit.bxor(${v_val},_k) or (${v_val}~_k);_x=(_x-_s-((${v_idx}-1)%17))%256;${v_table}.insert(${v_res},${v_char}(_x));end;return ${v_concat}(${v_res});end;local _c=${gv(10)}();local _f=${v_load}(_c);if _f then pcall(_f) end`;return ldr.replace(/\s+/g,' ').trim()}app.post('/api/obfuscate',(q,s)=>{const{code}=q.body;if(!code)return s.status(400).json({error:"No code provided"});try{const o=obfuscateLua(code);s.json({success:true,code:o})}catch(e){s.status(500).json({success:false,error:"Obfuscation failed: "+e.message})}});function checkVPN(i){return new Promise(r=>{if(i==='::1'||i==='127.0.0.1')return r(false);http.get(`http://ip-api.com/json/${i}?fields=status,mobile,proxy,hosting`,resp=>{let d='';resp.on('data',c=>d+=c);resp.on('end',()=>{try{const j=JSON.parse(d);r(j.status==='success'&&(j.proxy||j.hosting))}catch{r(false)}})}).on("error",()=>r(false))})}app.post('/api/admin/ban',(q,s)=>{const{email}=q.body;const u=db.settings[email];if(!u)return s.json({success:false,error:"User not found"});u.banned=true;if(u.lastIp&&!db.bannedIPs.includes(u.lastIp))db.bannedIPs.push(u.lastIp);saveDB();s.json({success:true})});app.listen(port,()=>console.log(`Running on ${port}`));
